import { createContext, ReactNode, useContext, useMemo, useState } from "react";

type Locale = "en" | "es";

type Translations = Record<string, string>;
type Dictionary = Record<Locale, Translations>;

const translations: Dictionary = {
  en: {
    "app.title": "Business Dashboard",
    "nav.customers": "Customers",
    "nav.orders": "Orders",
    "nav.products": "Products",
    "nav.logout": "Log out",
    "nav.guest": "Guest",
    "nav.mockNotice":
      "Mock data: initial records cannot be edited/deleted. Create new ones to test.",

    "login.title": "Sign in",
    "login.subtitle": "Use a valid mock email to sign in.",
    "login.admin": "Admin",
    "login.staff": "Staff",
    "login.button": "Sign in",
    "login.error.service": "Error contacting the service",
    "login.error.required": "Enter an email",
    "login.error.notFound": "Email not found",
    "login.error.failed": "Could not sign in. Detail: {error}",
    "login.success": "Signed in successfully",

    "customers.title": "Customers",
    "customers.subtitle": "Manage customers with search, filters and actions.",
    "customers.search": "Search",
    "customers.search.placeholder": "Search by name or email",
    "customers.status": "Status",
    "customers.sort": "Sort by",
    "customers.order": "Order",
    "customers.order.asc": "Ascending",
    "customers.order.desc": "Descending",
    "customers.pageSize": "Per page",
    "customers.new": "New customer",
    "customers.loading": "Loading customers...",
    "customers.empty": "No customers yet",
    "customers.empty.desc": "Create your first customer to start managing your data.",
    "customers.error": "Error loading customers.",
    "customers.retry": "Retry",
    "customers.actions": "Actions",
    "customers.state": "State",
    "customers.createdAt": "Created",
    "customers.name": "Name",
    "customers.email": "Email",
    "customers.delete.confirm": "Delete customer",
    "customers.delete.confirmName": "Delete {name}?",
    "customers.delete.desc": "This action cannot be undone.",
    "customers.edit": "Edit",
    "customers.delete": "Delete",
    "customers.success.create": "Customer created",
    "customers.success.update": "Customer updated",
    "customers.success.delete": "Customer deleted",
    "customers.error.save": "Could not save the customer. Detail: {error}",
    "customers.error.delete": "Could not delete the customer. Detail: {error}",
    "customers.error.load": "Error loading customers.",

    "customers.form.name": "Name",
    "customers.form.email": "Email",
    "customers.form.status": "Status",
    "customers.form.active": "Active",
    "customers.form.inactive": "Inactive",
    "customers.form.save": "Save",
    "customers.form.cancel": "Cancel",
    "customers.form.nameError": "Name is required",
    "customers.form.emailError": "Email is required",
    "customers.form.emailInvalid": "Invalid email",
    "customers.form.title.new": "New customer",
    "customers.form.title.edit": "Edit customer",

    "products.title": "Products",
    "products.subtitle": "Manage the product catalog.",
    "products.search": "Search",
    "products.search.placeholder": "Search product",
    "products.status": "Status",
    "products.pageSize": "Per page",
    "products.new": "New product",
    "products.loading": "Loading products...",
    "products.empty": "No products yet",
    "products.empty.desc": "Create your first product to fill your catalog.",
    "products.error": "Error loading products.",
    "products.retry": "Retry",
    "products.name": "Name",
    "products.price": "Price",
    "products.stock": "Stock",
    "products.state": "Status",
    "products.actions": "Actions",
    "products.edit": "Edit",
    "products.delete": "Delete",
    "products.delete.confirmName": "Delete {name}?",
    "products.form.title.new": "New product",
    "products.form.title.edit": "Edit product",
    "products.form.name": "Name",
    "products.form.price": "Price",
    "products.form.stock": "Stock",
    "products.form.status": "Status",
    "products.form.active": "Active",
    "products.form.archived": "Archived",
    "products.form.cancel": "Cancel",
    "products.form.save": "Save",
    "products.form.nameError": "Name is required",
    "products.form.priceError": "Invalid price",
    "products.form.stockError": "Invalid stock",
    "products.success.create": "Product created",
    "products.success.update": "Product updated",
    "products.success.delete": "Product deleted",
    "products.error.save": "Could not save the product. Detail: {error}",
    "products.error.delete": "Could not delete the product. Detail: {error}",

    "orders.title": "Orders",
    "orders.subtitle": "Update pending orders status.",
    "orders.search": "Search",
    "orders.search.placeholder": "Search by ID or customer",
    "orders.status": "Status",
    "orders.sort": "Sort by",
    "orders.order": "Order",
    "orders.order.asc": "Ascending",
    "orders.order.desc": "Descending",
    "orders.pageSize": "Per page",
    "orders.new": "New order",
    "orders.loading": "Loading orders...",
    "orders.empty": "No orders yet",
    "orders.empty.desc": "Create your first order to start tracking.",
    "orders.error": "Error loading orders.",
    "orders.retry": "Retry",
    "orders.id": "ID",
    "orders.customer": "Customer",
    "orders.total": "Total",
    "orders.createdAt": "Created",
    "orders.actions": "Actions",
    "orders.markPaid": "Mark paid",
    "orders.cancel": "Cancel",
    "orders.noActions": "No actions",
    "orders.success.update": "Status updated",
    "orders.error.update": "Could not update status. Detail: {error}",
    "orders.success.create": "Order created",
    "orders.error.create": "Could not create the order. Detail: {error}",
    "orders.form.title": "New order",
    "orders.form.customer": "Customer ID",
    "orders.form.total": "Total",
    "orders.form.status": "Status",
    "orders.form.pending": "Pending",
    "orders.form.paid": "Paid",
    "orders.form.cancelled": "Cancelled",
    "orders.form.create": "Create",
    "orders.form.cancel": "Cancel",
    "orders.form.customerError": "Customer is required",
    "orders.form.totalError": "Invalid total",

    "common.direction": "Direction",
    "common.actions": "Actions",
    "common.state": "Status",
    "common.createdAt": "Created",
    "common.retry": "Retry",
    "common.deleteConfirm": "Delete",
    "common.deleteDesc": "This action cannot be undone.",
    "common.all": "All",
    "common.pageLabel": "Page {page}",
    "common.prev": "Previous",
    "common.next": "Next",
    "common.saving": "Saving...",
    "common.creating": "Creating...",
  },
  es: {
    "app.title": "Business Dashboard",
    "nav.customers": "Clientes",
    "nav.orders": "Órdenes",
    "nav.products": "Productos",
    "nav.logout": "Salir",
    "nav.guest": "Invitado",
    "nav.mockNotice":
      "Datos de mock: los registros iniciales no se pueden editar/eliminar. Crea nuevos para probar.",

    "login.title": "Ingresar",
    "login.subtitle": "Usa un email válido del mock para entrar.",
    "login.admin": "Admin",
    "login.staff": "Staff",
    "login.button": "Entrar",
    "login.error.service": "Error al contactar el servicio",
    "login.error.required": "Ingresa un email",
    "login.error.notFound": "Email no encontrado",
    "login.error.failed": "No se pudo iniciar sesión. Detalle: {error}",
    "login.success": "Inicio de sesión exitoso",

    "customers.title": "Clientes",
    "customers.subtitle": "Gestión de clientes con búsqueda, filtros y acciones.",
    "customers.search": "Buscar",
    "customers.search.placeholder": "Buscar por nombre o email",
    "customers.status": "Estado",
    "customers.sort": "Ordenar por",
    "customers.order": "Dirección",
    "customers.order.asc": "Ascendente",
    "customers.order.desc": "Descendente",
    "customers.pageSize": "Por página",
    "customers.new": "Nuevo cliente",
    "customers.loading": "Cargando clientes...",
    "customers.empty": "Todavía no hay clientes",
    "customers.empty.desc": "Crea tu primer cliente para comenzar a gestionar los datos.",
    "customers.error": "Error al cargar clientes.",
    "customers.retry": "Reintentar",
    "customers.actions": "Acciones",
    "customers.state": "Estado",
    "customers.createdAt": "Creado",
    "customers.name": "Nombre",
    "customers.email": "Email",
    "customers.delete.confirm": "Eliminar cliente",
    "customers.delete.confirmName": "Eliminar {name}?",
    "customers.delete.desc": "Esta acción no se puede deshacer.",
    "customers.edit": "Editar",
    "customers.delete": "Eliminar",
    "customers.success.create": "Cliente creado",
    "customers.success.update": "Cliente actualizado",
    "customers.success.delete": "Cliente eliminado",
    "customers.error.save": "No se pudo guardar el cliente. Detalle: {error}",
    "customers.error.delete": "No se pudo eliminar el cliente. Detalle: {error}",
    "customers.error.load": "Error al cargar clientes.",

    "customers.form.name": "Nombre",
    "customers.form.email": "Email",
    "customers.form.status": "Estado",
    "customers.form.active": "Activo",
    "customers.form.inactive": "Inactivo",
    "customers.form.save": "Guardar",
    "customers.form.cancel": "Cancelar",
    "customers.form.nameError": "Nombre requerido",
    "customers.form.emailError": "Email requerido",
    "customers.form.emailInvalid": "Email inválido",
    "customers.form.title.new": "Nuevo cliente",
    "customers.form.title.edit": "Editar cliente",

    "products.title": "Productos",
    "products.subtitle": "Gestiona el catálogo de productos.",
    "products.search": "Buscar",
    "products.search.placeholder": "Buscar producto",
    "products.status": "Estado",
    "products.pageSize": "Por página",
    "products.new": "Nuevo producto",
    "products.loading": "Cargando productos...",
    "products.empty": "Todavía no hay productos",
    "products.empty.desc": "Crea tu primer producto para completar el catálogo.",
    "products.error": "Error al cargar productos.",
    "products.retry": "Reintentar",
    "products.name": "Nombre",
    "products.price": "Precio",
    "products.stock": "Stock",
    "products.state": "Estado",
    "products.actions": "Acciones",
    "products.edit": "Editar",
    "products.delete": "Eliminar",
    "products.delete.confirmName": "Eliminar {name}?",
    "products.form.title.new": "Nuevo producto",
    "products.form.title.edit": "Editar producto",
    "products.form.name": "Nombre",
    "products.form.price": "Precio",
    "products.form.stock": "Stock",
    "products.form.status": "Estado",
    "products.form.active": "Activo",
    "products.form.archived": "Archivado",
    "products.form.cancel": "Cancelar",
    "products.form.save": "Guardar",
    "products.form.nameError": "Nombre requerido",
    "products.form.priceError": "Precio inválido",
    "products.form.stockError": "Stock inválido",
    "products.success.create": "Producto creado",
    "products.success.update": "Producto actualizado",
    "products.success.delete": "Producto eliminado",
    "products.error.save": "No se pudo guardar el producto. Detalle: {error}",
    "products.error.delete": "No se pudo eliminar el producto. Detalle: {error}",

    "orders.title": "Órdenes",
    "orders.subtitle": "Actualiza el estado de las órdenes pendientes.",
    "orders.search": "Buscar",
    "orders.search.placeholder": "Buscar por ID o cliente",
    "orders.status": "Estado",
    "orders.sort": "Ordenar por",
    "orders.order": "Dirección",
    "orders.order.asc": "Ascendente",
    "orders.order.desc": "Descendente",
    "orders.pageSize": "Por página",
    "orders.new": "Nueva orden",
    "orders.loading": "Cargando órdenes...",
    "orders.empty": "Todavía no hay órdenes",
    "orders.empty.desc": "Crea tu primera orden para comenzar a seguirlas.",
    "orders.error": "Error al cargar órdenes.",
    "orders.retry": "Reintentar",
    "orders.id": "ID",
    "orders.customer": "Cliente",
    "orders.total": "Total",
    "orders.createdAt": "Creado",
    "orders.actions": "Acciones",
    "orders.markPaid": "Marcar pagada",
    "orders.cancel": "Cancelar",
    "orders.noActions": "Sin acciones",
    "orders.success.update": "Estado actualizado",
    "orders.error.update": "No se pudo actualizar el estado. Detalle: {error}",
    "orders.success.create": "Orden creada",
    "orders.error.create": "No se pudo crear la orden. Detalle: {error}",
    "orders.form.title": "Nueva orden",
    "orders.form.customer": "Cliente ID",
    "orders.form.total": "Total",
    "orders.form.status": "Estado",
    "orders.form.pending": "Pendiente",
    "orders.form.paid": "Pagada",
    "orders.form.cancelled": "Cancelada",
    "orders.form.create": "Crear",
    "orders.form.cancel": "Cancelar",
    "orders.form.customerError": "Cliente requerido",
    "orders.form.totalError": "Total inválido",

    "common.direction": "Dirección",
    "common.actions": "Acciones",
    "common.state": "Estado",
    "common.createdAt": "Creado",
    "common.retry": "Reintentar",
    "common.deleteConfirm": "Eliminar",
    "common.deleteDesc": "Esta acción no se puede deshacer.",
    "common.all": "Todos",
    "common.pageLabel": "Página {page}",
    "common.prev": "Anterior",
    "common.next": "Siguiente",
    "common.saving": "Guardando...",
    "common.creating": "Creando...",
  },
};

type I18nContextValue = {
  locale: Locale;
  t: (key: string, vars?: Record<string, string | number>) => string;
  toggleLocale: () => void;
};

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

export const I18nProvider = ({ children }: { children: ReactNode }) => {
  const [locale, setLocale] = useState<Locale>("en");

  const t = (key: string, vars?: Record<string, string | number>) => {
    const entry = translations[locale][key] ?? translations.en[key] ?? key;
    if (!vars) return entry;
    return Object.keys(vars).reduce(
      (acc, varKey) =>
        acc.replace(`{${varKey}}`, String(vars[varKey])),
      entry
    );
  };

  const toggleLocale = () => setLocale((prev) => (prev === "en" ? "es" : "en"));

  const value = useMemo(() => ({ locale, t, toggleLocale }), [locale]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export const useI18n = () => {
  const ctx = useContext(I18nContext);
  if (!ctx) {
    throw new Error("useI18n must be used within I18nProvider");
  }
  return ctx;
};
